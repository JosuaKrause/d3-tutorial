<!DOCTYPE html>
<html lang="en">
<head>
  <title>D3-Tutorial</title>
  <meta charset="utf-8">
  <script src="d3.min.js" charset="utf-8"></script>
  <style>
    * {
      font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
    }
  </style>
</head>
<body onload="start()">

<div id="divContent"></div>

<script>
function start() {
  var w = 800;
  var h = 600;
  var radius = 2;

  var content = d3.select("#divContent");
  var svg = content.append("svg").attr({
    "width": w,
    "height": h
  }).style({
    "border": "solid black 1px"
  });

  d3.json("https://raw.githubusercontent.com/JosuaKrause/d3-tutorial/master/example.json", function(err, data) {
    if(err) {
      console.warn(err);
      return;
    }

    var events = data["events"];
    var types = {};
    var groups = {};
    events.forEach(function(e) {
      types[e["id"]] = Math.min(+e["time"], e["id"] in types ? types[e["id"]] : Number.POSITIVE_INFINITY);
      groups[e["group"]] = true;
    });
    var typeList = Object.keys(types);
    typeList.sort(function(ta, tb) {
      return d3.ascending(types[ta], types[tb]);
    });
    var yPos = {};
    typeList.forEach(function(tid, ix) {
      yPos[tid] = h - ix * radius;
    });

    var times = events.map(function(e) {
      return +e["time"] * 1000;
    });

    var xScale = d3.time.scale().domain([ d3.min(times), d3.max(times) ]).range([ 0, w ]).nice();

    var groupScale = d3.scale.category10().domain(Object.keys(groups));

    var sel = svg.selectAll("circle.event").data(events);
    sel.exit().remove();
    sel.enter().append("circle").classed("event", true);
    sel.attr({
      "cx": function(e) {
        return xScale(+e["time"] * 1000);
      },
      "cy": function(e) {
        return yPos[e["id"]];
      },
      "r": radius,
      "fill": function(e) {
        return groupScale(e["group"]);
      }
    });
  });
}

</script>

</body>
</html>
